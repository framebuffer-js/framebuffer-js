var A=a=>typeof a==='function';class Framebuffer{static version='20250324';canvas=null;width=0;height=0;context=null;image=null;created=0;updated=0;path=null;ready=!0;locked=!1;dirty=!1;error=null;container=null;static create(_=0,B=0){let c=new Framebuffer;_|=B|=0;if(0>=_||_>8192){c.error='bad width';return c}if(0>=B||B>8192){c.error='bad height';return c}c.created=+Date.now();c.width=_;c.height=B;c.canvas=document.createElement('canvas');c.canvas.width=_;c.canvas.height=B;c.context=c.canvas.getContext('2d',{alpha:!1,colorSpace:'srgb',desynchronized:!1,willReadFrequently:!0});if(c.context===null){c.error='canvas not supported';return c}c.image=new ImageData(_, B);c.image.data.fill(255);c.sync();return c}static load(C=null,_b=null){if(C===null)return null;let _c=A(_b);let d=Framebuffer.create(1,1).lock();d.ready=!1;d.path=C;let e=new Image;e.onload=()=>{let _a=e.width;let D=e.height;d.ready=!0;d.canvas.width=_a;d.canvas.height=D;d.width=_a;d.height=D;d.context.drawImage(e,0,0,_a,D);d.image=d.context.getImageData(0,0,_a,D);d.unlock();_c&&_b(d)};e.onerror=()=>{d.error='failed to load image';_c&&_b(d)};e.src=C;return d}sync(){this.context.putImageData(this.image,0,0);this.dirty=!1;this.updated=+Date.now();return this}setColor(x,y,r,g,b){if(this.locked)return this;x|=y|=0;let f=this.width*y*4+x*4;this.image.data[f+0]=r;this.image.data[f+1]=g;this.image.data[f+2]=b;this.dirty=!0;return this}getColor(x,y){x|=y|=0;let _C=this.width*y*4+x*4;return[this.image.data[_C+0],this.image.data[_C+1],this.image.data[_C+2]]}setAlpha(x,y,a){if(this.locked)return this;x|=y|=0;let _d=this.width*y*4+x*4;this.image.data[_d+3]=a;this.dirty=!0;return this}getAlpha(x,y){x|=y|=0;let E=this.width*y*4+x*4;return this.image.data[E+3]}spawn(_A=null){if(_A===null||_A instanceof Element===!1){this.error='expects container to be an element';return this}if(this.container!==null){this.error='resource already spawned';return this}_A.append(this.canvas);this.container=_A;return this}despawn(){if(this.container===null)return this;let aA=this.canvas.parentElement;if(aA===null)return this;aA.removeChild(this.canvas);this.container=null;return this}clear(r=0,g=0,b=0){if(this.locked)return this;for(let i=0;i<this.image.data.length;i+=4){this.image.data[i+0]=r;this.image.data[i+1]=g;this.image.data[i+2]=b}return this}save(aB='0.png'){let a=document.createElement('a');a.href=this.canvas.toDataURL();a.download=aB;a.click();return this}lock(){this.locked=!0;return this}unlock(){this.locked=!1;return this}clone(){let aC=Framebuffer.create(this.width,this.height);for(let i=0,j=this.image.data.length;i<j;i+=4){aC.image.data[i+0]=this.image.data[i+0];aC.image.data[i+1]=this.image.data[i+1];aC.image.data[i+2]=this.image.data[i+2];aC.image.data[i+3]=this.image.data[i+3]}aC.sync();return aC}}
