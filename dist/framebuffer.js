class Framebuffer{static version="20250324";canvas=null;width=0;height=0;context=null;image=null;created=0;updated=0;path=null;ready=!0;locked=!1;dirty=!1;error=null;container=null;static create(t=0,e=0){let a=new Framebuffer;return e|=0,0>=(t|=0)||t>8192?(a.error="bad width",a):0>=e||e>8192?(a.error="bad height",a):(a.created=+Date.now(),a.width=t,a.height=e,a.canvas=document.createElement("canvas"),a.canvas.width=t,a.canvas.height=e,a.context=a.canvas.getContext("2d",{alpha:!1,colorSpace:"srgb",desynchronized:!1,willReadFrequently:!0}),null===a.context?(a.error="canvas not supported",a):(a.image=new ImageData(t,e),a.image.data.fill(255),a.sync(),a))}static load(t=null,e=null){if(null===t)return null;let a="function"==typeof e,i=Framebuffer.create(1,1).lock();i.ready=!1,i.path=t;let n=new Image;return n.onload=function(){let t=n.width,r=n.height;i.ready=!0,i.canvas.width=t,i.canvas.height=r,i.width=t,i.height=r,i.context.drawImage(n,0,0,t,r),i.image=i.context.getImageData(0,0,t,r),i.unlock(),a&&e(i)},n.onerror=function(){i.error="failed to load image",a&&e(i)},n.src=t,i}sync(){return this.context.putImageData(this.image,0,0),this.dirty=!1,this.updated=+Date.now(),this}setColor(t,e,a,i,n){if(this.locked)return this;t|=0,e|=0;let r=this.width*e*4+4*t;return this.image.data[r+0]=a,this.image.data[r+1]=i,this.image.data[r+2]=n,this.dirty=!0,this}getColor(t,e){t|=0,e|=0;let a=this.width*e*4+4*t;return[this.image.data[a+0],this.image.data[a+1],this.image.data[a+2]]}setAlpha(t,e,a){if(this.locked)return this;t|=0,e|=0;let i=this.width*e*4+4*t;return this.image.data[i+3]=a,this.dirty=!0,this}getAlpha(t,e){t|=0,e|=0;let a=this.width*e*4+4*t;return this.image.data[a+3]}spawn(t=null){return null===t||t instanceof Element==!1?(this.error="expects container to be an element",this):null!==this.container?(this.error="resource already spawned",this):(t.append(this.canvas),this.container=t,this)}despawn(){if(null===this.container)return this;let t=this.canvas.parentElement;return null===t||(t.removeChild(this.canvas),this.container=null),this}clear(t=0,e=0,a=0){if(this.locked)return this;for(let i=0;i<this.image.data.length;i+=4)this.image.data[i+0]=t,this.image.data[i+1]=e,this.image.data[i+2]=a;return this}save(t="0.png"){let e=document.createElement("a");return e.href=this.canvas.toDataURL(),e.download=t,e.click(),this}lock(){return this.locked=!0,this}unlock(){return this.locked=!1,this}clone(){let t=Framebuffer.create(this.width,this.height);for(let e=0,a=this.image.data.length;e<a;e+=4)t.image.data[e+0]=this.image.data[e+0],t.image.data[e+1]=this.image.data[e+1],t.image.data[e+2]=this.image.data[e+2],t.image.data[e+3]=this.image.data[e+3];return t.sync(),t}}